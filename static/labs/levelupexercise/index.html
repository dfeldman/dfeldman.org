<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Journey</title>
    <style>
        :root {
            --primary: #FF5733;
            --secondary: #33B5FF;
            --success: #4CAF50;
            --dark: #2C3E50;
            --light: #ECF0F1;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            gap: 10px;
            background: var(--light);
            padding: 10px;
            border-radius: 15px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: white;
            font-size: 16px;
            font-weight: bold;
            color: var(--dark);
            border-radius: 10px;
            transition: all 0.3s ease;
            flex: 1 1 auto;
            min-width: 100px;
            text-align: center;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .content.active {
            display: block;
        }

        .level-selector {
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--light);
            padding: 15px;
            border-radius: 12px;
        }

        .level-control {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .level-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .level-btn:active {
            transform: scale(0.95);
        }

        input[type="range"] {
            flex: 1;
            height: 10px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--secondary);
            border-radius: 50%;
            cursor: pointer;
        }

        .level-display {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            min-width: 50px;
            text-align: center;
        }

        .cardio-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .cardio-nav button {
            padding: 12px;
            border: none;
            background-color: var(--light);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .cardio-nav button.active {
            background-color: var(--secondary);
            color: white;
            transform: scale(1.05);
        }

        .exercise-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--primary);
        }

        .exercise-card h3 {
            color: var(--primary);
            margin-top: 0;
        }

        .milestone {
            color: var(--success);
            font-weight: bold;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            margin: 10px 0;
        }

        .calories {
            display: inline-block;
            padding: 5px 10px;
            background: var(--success);
            color: white;
            border-radius: 15px;
            font-size: 14px;
            margin-top: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric {
            background: var(--light);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary);
        }

        .workout-instruction {
            font-size: 1.1em;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .exercise-card h4 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .exercise-card h5 {
            color: var(--dark);
            margin: 20px 0 10px 0;
        }

        .exercise-card p {
            margin: 15px 0;
            line-height: 1.4;
        }

        .exercise-card ul,
        .exercise-card ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .exercise-card li {
            margin: 8px 0;
        }

        .recovery-note {
            background: var(--light);
            padding: 10px;
            border-radius: 6px;
            margin-top: 20px;
        }


        .goal-card {
            background-color: var(--light);
            border-left: 5px solid var(--success);
        }

        .goal-progress {
            padding: 15px;
        }

        .goal-label {
            font-weight: bold;
            color: var(--dark);
            margin-right: 10px;
        }

        .goal-text {
            color: var(--primary);
        }

        .progress-marker {
            margin-top: 10px;
            padding: 5px 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 4px;
        }

        .stretch-goal {
            color: var(--success);
            font-style: italic;
            margin-top: 10px;
        }

        .special-notes {
            background-color: var(--light);
            border-left: 5px solid var(--secondary);
            margin-bottom: 20px;
        }

        .notes-list {
            margin: 10px 0;
            padding-left: 20px;
        }

        .note-item {
            margin: 8px 0;
            line-height: 1.4;
            color: var(--dark);
        }

        .timer-container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
        }

        .time-display {
            font-size: 72px;
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            font-variant-numeric: tabular-nums;
        }

        .interval-info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--light);
        }

        .current-activity {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .next-up {
            font-size: 16px;
            color: #666;
            margin: 5px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--secondary);
            transition: width 1s linear;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.95);
        }

        .play-pause {
            background-color: var(--success);
            color: white;
        }

        .reset {
            background-color: var(--secondary);
            color: white;
        }

        .exit {
            background-color: var(--primary);
            color: white;
        }

        .workout-progress {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        @media (max-width: 480px) {
            .time-display {
                font-size: 48px;
            }
            
            .current-activity {
                font-size: 20px;
            }
        }

        .timer-view {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* Add a Start Timer button style */
        .start-timer-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('cardio')">Cardio</button>
            <button class="tab" onclick="switchTab('strength')">Strength</button>
            <button class="tab" onclick="switchTab('flexibility')">Flexibility</button>
        </div>

        <div id="cardio" class="content active">
            <div class="cardio-nav">
                <button class="active" onclick="switchCardio('run')">Running</button>
                <button onclick="switchCardio('bike')">Biking</button>
                <button onclick="switchCardio('swim')">Swimming</button>
                <button onclick="switchCardio('row')">Rowing</button>
            </div>
            <div class="level-selector">
                <div class="level-control">
                    <button class="level-btn" onclick="adjustLevel('cardio', -1)">-</button>
                    <input type="range" min="1" max="100" value="1" id="cardioLevel">
                    <button class="level-btn" onclick="adjustLevel('cardio', 1)">+</button>
                </div>
                <span class="level-display" id="cardioLevelDisplay">1</span>
            </div>
            <div id="cardioContent"></div>
        </div>

        <div id="strength" class="content">
            <div class="level-selector">
                <div class="level-control">
                    <button class="level-btn" onclick="adjustLevel('strength', -1)">-</button>
                    <input type="range" min="1" max="100" value="1" id="strengthLevel">
                    <button class="level-btn" onclick="adjustLevel('strength', 1)">+</button>
                </div>
                <span class="level-display" id="strengthLevelDisplay">1</span>
            </div>
            <div id="strengthContent"></div>
        </div>

        <div id="flexibility" class="content">
            <div class="level-selector">
                <div class="level-control">
                    <button class="level-btn" onclick="adjustLevel('flex', -1)">-</button>
                    <input type="range" min="1" max="100" value="1" id="flexLevel">
                    <button class="level-btn" onclick="adjustLevel('flex', 1)">+</button>
                </div>
                <span class="level-display" id="flexLevelDisplay">1</span>
            </div>
            <div id="flexContent"></div>
        </div>
    </div>

    <div class="timer-view" style="display: none;">
        <div class="timer-container">
            <div class="time-display">00:00</div>
            <div class="interval-info">
                <div class="current-activity">Get Ready!</div>
                <div class="next-up">Starting soon...</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="workout-progress">
                Set 1 of 3
            </div>
            <div class="controls">
                <button class="play-pause">Start</button>
                <button class="reset">Reset</button>
                <button class="exit">Exit</button>
            </div>
        </div>
    </div>

    <script>
        let levels = {
            cardio: parseInt(localStorage.getItem('cardioLevel')) || 1,
            strength: parseInt(localStorage.getItem('strengthLevel')) || 1,
            flex: parseInt(localStorage.getItem('flexLevel')) || 1
        };

        let currentCardioType = 'run';

        // Initialize ranges
        document.getElementById('cardioLevel').value = levels.cardio;
        document.getElementById('strengthLevel').value = levels.strength;
        document.getElementById('flexLevel').value = levels.flex;
        document.getElementById('cardioLevelDisplay').textContent = levels.cardio;
        document.getElementById('strengthLevelDisplay').textContent = levels.strength;
        document.getElementById('flexLevelDisplay').textContent = levels.flex;

        class IntervalTimer {
            constructor() {
                this.intervals = [];
                this.currentInterval = 0;
                this.currentSet = 0;
                this.timeRemaining = 0;
                this.isRunning = false;
                this.timer = null;
                this.totalSets = 0;

                // DOM elements
                this.timeDisplay = document.querySelector('.time-display');
                this.currentActivityDisplay = document.querySelector('.current-activity');
                this.nextUpDisplay = document.querySelector('.next-up');
                this.progressBar = document.querySelector('.progress-fill');
                this.workoutProgress = document.querySelector('.workout-progress');
                this.playPauseButton = document.querySelector('.play-pause');
                this.resetButton = document.querySelector('.reset');
                this.exitButton = document.querySelector('.exit');

                // Bind event listeners
                this.playPauseButton.addEventListener('click', () => this.togglePlayPause());
                this.resetButton.addEventListener('click', () => this.reset());
                this.exitButton.addEventListener('click', () => this.exit());
            }

            setWorkout(workout) {
                // Workout should be an array of interval sets
                this.intervals = workout;
                this.totalSets = workout.length;
                this.reset();
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            updateDisplay() {
                if (this.currentSet >= this.totalSets) {
                    this.complete();
                    return;
                }

                const currentInterval = this.intervals[this.currentSet];
                this.timeDisplay.textContent = this.formatTime(this.timeRemaining);
                
                const totalIntervalTime = currentInterval.duration;
                const progress = ((totalIntervalTime - this.timeRemaining) / totalIntervalTime) * 100;
                this.progressBar.style.width = `${progress}%`;

                this.currentActivityDisplay.textContent = currentInterval.activity;
                
                // Show next activity
                const nextSet = this.currentSet + 1;
                if (nextSet < this.totalSets) {
                    this.nextUpDisplay.textContent = `Next: ${this.intervals[nextSet].activity}`;
                } else {
                    this.nextUpDisplay.textContent = 'Final interval!';
                }

                this.workoutProgress.textContent = `Set ${this.currentSet + 1} of ${this.totalSets}`;
            }

            start() {
                if (!this.isRunning) {
                    this.isRunning = true;
                    this.playPauseButton.textContent = 'Pause';
                    this.timer = setInterval(() => this.tick(), 1000);
                }
            }

            pause() {
                if (this.isRunning) {
                    this.isRunning = false;
                    this.playPauseButton.textContent = 'Resume';
                    clearInterval(this.timer);
                }
            }

            togglePlayPause() {
                if (this.isRunning) {
                    this.pause();
                } else {
                    this.start();
                }
            }

            tick() {
                if (this.timeRemaining > 0) {
                    this.timeRemaining--;
                    this.updateDisplay();
                } else {
                    // Play sound or notification here
                    this.currentSet++;
                    if (this.currentSet < this.totalSets) {
                        this.timeRemaining = this.intervals[this.currentSet].duration;
                        this.updateDisplay();
                    } else {
                        this.complete();
                    }
                }
            }

            reset() {
                this.pause();
                this.currentSet = 0;
                this.timeRemaining = this.intervals[0]?.duration || 0;
                this.playPauseButton.textContent = 'Start';
                this.updateDisplay();
            }

            complete() {
                this.pause();
                this.currentActivityDisplay.textContent = 'Workout Complete!';
                this.nextUpDisplay.textContent = 'Great job!';
                this.timeDisplay.textContent = '00:00';
                this.progressBar.style.width = '100%';
            }

            exit() {
                // This will be implemented when integrated with main app
                console.log('Exit timer');
            }
        }

        function formatPace(pace, type) {
            switch (type) {
                case 'run':
                    // pace in minutes per mile
                    const minutes = Math.floor(pace);
                    const seconds = Math.round((pace - minutes) * 60);
                    return `${minutes}:${seconds.toString().padStart(2, '0')}/mile (${(60 / pace).toFixed(1)} mph)`;
                case 'bike':
                    // pace in mph
                    return `${pace.toFixed(1)} mph`;
                case 'swim':
                    // pace in seconds per lap
                    const min = Math.floor(pace / 60);
                    const sec = Math.round(pace % 60);
                    return `${min}:${sec.toString().padStart(2, '0')}/lap`;
                case 'row':
                    // pace in seconds per 500m
                    const paceMin = Math.floor(pace / 60);
                    const paceSec = Math.round(pace % 60);
                    return `${paceMin}:${paceSec.toString().padStart(2, '0')}/500m`;
            }
        }


        function adjustLevel(type, change) {
            const newLevel = Math.max(1, Math.min(100, levels[type] + change));
            levels[type] = newLevel;
            document.getElementById(`${type}Level`).value = newLevel;
            document.getElementById(`${type}LevelDisplay`).textContent = newLevel;
            localStorage.setItem(`${type}Level`, newLevel);
            updateContent();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            updateContent();
        }

        function switchCardio(type) {
            currentCardioType = type;
            document.querySelectorAll('.cardio-nav button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateCardioContent();
        }

        document.getElementById('cardioLevel').addEventListener('input', (e) => {
            levels.cardio = parseInt(e.target.value);
            document.getElementById('cardioLevelDisplay').textContent = levels.cardio;
            localStorage.setItem('cardioLevel', levels.cardio);
            updateCardioContent();
        });

        document.getElementById('strengthLevel').addEventListener('input', (e) => {
            levels.strength = parseInt(e.target.value);
            document.getElementById('strengthLevelDisplay').textContent = levels.strength;
            localStorage.setItem('strengthLevel', levels.strength);
            updateStrengthContent();
        });

        document.getElementById('flexLevel').addEventListener('input', (e) => {
            levels.flex = parseInt(e.target.value);
            document.getElementById('flexLevelDisplay').textContent = levels.flex;
            localStorage.setItem('flexLevel', levels.flex);
            updateFlexContent();
        });

        function roundTo10Seconds(seconds) {
            return Math.round(seconds / 10) * 10;
        }


        // Helper functions for formatting and calculations
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.round(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function formatPace(pace, type) {
            switch (type) {
                case 'run':
                    const minutes = Math.floor(pace);
                    const seconds = Math.round((pace - minutes) * 60);
                    return `${minutes}:${seconds.toString().padStart(2, '0')}/mile (${(60 / pace).toFixed(1)} mph)`;
                case 'bike':
                    return `${pace.toFixed(1)} mph`;
                case 'swim':
                    return `${formatTime(pace)}/lap`;
                case 'row':
                    return `${formatTime(pace)}/500m`;
                default:
                    return pace.toString();
            }
        }

        // HTML Formatting helper functions
        function formatWorkoutHeader(workout) {
            return `
        <div class="workout-header">
            <h4>${workout.title}</h4>
            <div class="metrics-grid">
                ${workout.time ? `
                <div class="metric">
                    <span class="metric-label">Time</span>
                    <span class="metric-value">${workout.time} minutes</span>
                </div>
                ` : ''}
                ${workout.distance ? `
                    <div class="metric">
                        <span class="metric-label">Distance</span>
                        <span class="metric-value">${workout.type === 'swim' ?
                        `${workout.laps} laps (${workout.distance}yd)` :
                        workout.type === 'row' ?
                            `${workout.distance}m` :
                            `${workout.distance} miles`}</span>
                    </div>
                ` : ''}
                ${workout.pace ? `
                    <div class="metric">
                        <span class="metric-label">Target Pace</span>
                        <span class="metric-value">${formatPace(workout.pace, workout.type)}</span>
                    </div>
                ` : ''}
                ${workout.watts ? `
                    <div class="metric">
                        <span class="metric-label">Target Power</span>
                        <span class="metric-value">${workout.watts} watts</span>
                    </div>
                ` : ''}
                ${workout.spm ? `
                    <div class="metric">
                        <span class="metric-label">Stroke Rate</span>
                        <span class="metric-value">${workout.spm} SPM</span>
                    </div>
                ` : ''}
            </div>
        </div>`;
        }

        function formatWorkoutStructure(steps) {
            if (!steps || steps.length === 0) return '';
            return `
        <div class="workout-structure">
            <h5>Workout Structure</h5>
            <ol>
                ${steps.map(step => `<li>${step}</li>`).join('')}
            </ol>
        </div>`;
        }

        function formatFormCues(cues) {
            if (!cues || cues.length === 0) return '';
            return `
        <div class="form-cues">
            <h5>Form Cues</h5>
            <ul>
                ${cues.map(cue => `<li>${cue}</li>`).join('')}
            </ul>
        </div>`;
        }

        function formatNotes(notes) {
            if (!notes || notes.length === 0) return '';
            return `
        <div class="workout-notes">
            <h5>Important Notes</h5>
            <ul>
                ${notes.map(note => `<li>${note}</li>`).join('')}
            </ul>
        </div>`;
        }

        function formatCalories(calories) {
            return `
        <div class="calorie-estimate">
            <span class="label">Estimated Calories:</span>
            <span class="value">${calories}</span>
        </div>`;
        }
// old don't use
        function formatIntervalSet(intervals) {
            if (!intervals) return '';
            return `
        <div class="interval-set">
            <h5>Interval Structure</h5>
            <div class="interval-details">
                <p>${intervals.sets} sets of:</p>
                <ul>
                    <li>Work: ${formatTime(intervals.activeTime)} at ${intervals.type.active}</li>
                    <li>Rest: ${formatTime(intervals.restTime)} at ${intervals.type.rest}</li>
                </ul>
            </div>
        </div>`;
        }

        // Main workout generation helpers
        function generateIntervals(level, type) {
            const patterns = [
                [30, 120, 6],    // Level 11: 30s run/120s walk × 6
                [30, 90, 7],     // Level 12
                [45, 90, 6],     // Level 13
                [60, 90, 6],     // Level 14
                [60, 60, 7],     // Level 15
                [90, 60, 5],     // Level 16
                [120, 60, 4],    // Level 17
                [180, 60, 3],    // Level 18
                [300, 120, 2],   // Level 19
                [480, 120, 1]    // Level 20: 8min run/2min walk × 1
            ];

            const idx = level - 11;
            if (idx >= 0 && idx < patterns.length) {
                const [activeTime, restTime, sets] = patterns[idx];
                return {
                    activeTime,
                    restTime,
                    sets,
                    type: type === 'run' ?
                        { active: 'Run', rest: 'Walk' } :
                        { active: 'Fast bike', rest: 'Easy bike' }
                };
            }
            return null;
        }

        function generateBeginnerRunningIntervals(level) {
    // This function handles levels 10-20, where we transition from walking to running
    if (level < 10 || level > 20) {
        throw new Error("This generator is designed for levels 10-20 only");
    }

    // First, let's define what characterizes good beginner running intervals:
    // - Start with more walking than running
    // - Gradually increase running time while decreasing walking time
    // - Keep total workout time around 30 minutes
    // - Begin with very short running intervals (30-60 seconds)
    // - Progress to longer running segments (3-5 minutes)
    // - Include proper warm-up and cool-down

    if (level === 10) {
        // Level 10 is a transition level - introducing very short running segments
        return {
            type: "interval",
            sets: [{
                repeat: 1,
                intervals: [{
                    activity: "Warm-up Walk",
                    duration: 300,  // 5 minutes
                    intensity: "comfortable pace"
                }]
            }, {
                repeat: 6,         // Main workout: 6 sets of run/walk
                intervals: [
                    {
                        activity: "Very Light Jog",
                        duration: 30,  // 30 seconds
                        intensity: "just faster than walking",
                        targetMetrics: { pace: 13 }  // 13:00 min/mile
                    },
                    {
                        activity: "Walk",
                        duration: 120,  // 2 minutes
                        intensity: "brisk pace",
                        targetMetrics: { pace: 18 }  // 18:00 min/mile
                    }
                ]
            }, {
                repeat: 1,
                intervals: [{
                    activity: "Cool-down Walk",
                    duration: 300,  // 5 minutes
                    intensity: "easy pace"
                }]
            }],
            totalDuration: 1500,  // 25 minutes total
            description: "Introduction to Running Intervals"
        };
    }

    // Levels 11-15: Gradually increase running duration, decrease walking duration
    if (level <= 15) {
        const runDuration = 30 + (level - 10) * 15;  // Increases from 30s to 120s
        const walkDuration = 120 - (level - 10) * 10; // Decreases from 120s to 70s
        const sets = 7 - Math.floor((level - 10) / 2); // Decreases from 7 to 5 sets

        return {
            type: "interval",
            sets: [{
                repeat: 1,
                intervals: [{
                    activity: "Warm-up Walk",
                    duration: 300,
                    intensity: "comfortable pace"
                }]
            }, {
                repeat: sets,
                intervals: [
                    {
                        activity: "Run",
                        duration: runDuration,
                        intensity: "conversational pace",
                        targetMetrics: { pace: 12.5 - (level - 10) * 0.1 }
                    },
                    {
                        activity: "Walk",
                        duration: walkDuration,
                        intensity: "brisk pace",
                        targetMetrics: { pace: 18 }
                    }
                ]
            }, {
                repeat: 1,
                intervals: [{
                    activity: "Cool-down Walk",
                    duration: 300,
                    intensity: "easy pace"
                }]
            }],
            totalDuration: 300 + (runDuration + walkDuration) * sets + 300,
            description: `Running Builder - Level ${level}`
        };
    }

    // Levels 16-20: Transition to longer running segments with shorter recovery
    if (level <= 20) {
        const baseRunDuration = 180 + (level - 15) * 60;  // 3 minutes to 8 minutes
        const walkDuration = Math.max(60, 90 - (level - 15) * 10);  // 90s down to 60s
        const sets = 4 - Math.floor((level - 15) / 2);  // 4 down to 2 sets

        return {
            type: "interval",
            sets: [{
                repeat: 1,
                intervals: [{
                    activity: "Warm-up Walk/Light Jog",
                    duration: 300,
                    intensity: "easy pace building to light jog"
                }]
            }, {
                repeat: sets,
                intervals: [
                    {
                        activity: "Run",
                        duration: baseRunDuration,
                        intensity: "steady, conversational pace",
                        targetMetrics: { pace: 11.5 - (level - 15) * 0.1 }
                    },
                    {
                        activity: "Walk",
                        duration: walkDuration,
                        intensity: "brisk recovery",
                        targetMetrics: { pace: 17 }
                    }
                ]
            }, {
                repeat: 1,
                intervals: [{
                    activity: "Cool-down Walk",
                    duration: 300,
                    intensity: "easy pace"
                }]
            }],
            totalDuration: 300 + (baseRunDuration + walkDuration) * sets + 300,
            description: `Endurance Builder - Level ${level}`
        };
    }
}

function generateBeginnerBikingIntervals(level) {
    if (level < 10 || level > 20) {
        throw new Error("This generator is designed for levels 10-20 only");
    }

    // Level 10 introduces the concept of varying effort on the bike
    if (level === 10) {
        return {
            type: "interval",
            sets: [{
                repeat: 1,
                intervals: [{
                    activity: "Warm-up Spin",
                    duration: 300,  // 5 minutes
                    intensity: "light resistance",
                    targetMetrics: { 
                        speed: 10,  // mph
                        cadence: 60, // RPM
                        watts: 50
                    }
                }]
            }, {
                repeat: 5,         // Main workout: 5 sets of push/recover
                intervals: [
                    {
                        activity: "Light Push",
                        duration: 60,  // 1 minute
                        intensity: "medium resistance, steady spin",
                        targetMetrics: { 
                            speed: 12,
                            cadence: 70,
                            watts: 75
                        }
                    },
                    {
                        activity: "Easy Spin",
                        duration: 120,  // 2 minutes
                        intensity: "light resistance",
                        targetMetrics: { 
                            speed: 10,
                            cadence: 65,
                            watts: 50
                        }
                    }
                ]
            }, {
                repeat: 1,
                intervals: [{
                    activity: "Cool-down",
                    duration: 300,
                    intensity: "very light resistance"
                }]
            }],
            totalDuration: 1500,  // 25 minutes total
            description: "Introduction to Cycling Intervals"
        };
    }

    // Levels 11-15: Build endurance with longer efforts
    if (level <= 15) {
        const pushDuration = 60 + (level - 10) * 15;  // Increases from 60s to 135s
        const recoveryDuration = Math.max(60, 120 - (level - 10) * 10); // Decreases from 120s to 60s
        const sets = 6 - Math.floor((level - 10) / 2); // Decreases from 6 to 4 sets
        
        // We gradually increase intensity through speed and resistance
        const pushSpeed = 12 + (level - 10) * 0.5;  // 12 mph to 14.5 mph
        const pushWatts = 75 + (level - 10) * 10;   // 75W to 125W

        return {
            type: "interval",
            sets: [{
                repeat: 1,
                intervals: [{
                    activity: "Warm-up Spin",
                    duration: 300,
                    intensity: "gradually increasing resistance",
                    targetMetrics: {
                        speed: 10,
                        cadence: 70,
                        watts: 60
                    }
                }]
            }, {
                repeat: sets,
                intervals: [
                    {
                        activity: "Push Interval",
                        duration: pushDuration,
                        intensity: "medium-high resistance",
                        targetMetrics: {
                            speed: pushSpeed,
                            cadence: 75,
                            watts: pushWatts
                        }
                    },
                    {
                        activity: "Recovery Spin",
                        duration: recoveryDuration,
                        intensity: "light resistance",
                        targetMetrics: {
                            speed: 10,
                            cadence: 70,
                            watts: 60
                        }
                    }
                ]
            }, {
                repeat: 1,
                intervals: [{
                    activity: "Cool-down",
                    duration: 300,
                    intensity: "decreasing to very light resistance"
                }]
            }],
            totalDuration: 300 + (pushDuration + recoveryDuration) * sets + 300,
            description: `Cycling Power Builder - Level ${level}`
        };
    }

    // Levels 16-20: Introduction to sustained power intervals
    if (level <= 20) {
        const pushDuration = 180 + (level - 15) * 30;  // 3 minutes to 5 minutes
        const recoveryDuration = 60;  // Consistent 1-minute recovery
        const sets = 4 - Math.floor((level - 15) / 2);  // 4 down to 2 longer sets
        
        // Continue progressing intensity
        const pushSpeed = 15 + (level - 15) * 0.5;  // 15 mph to 17.5 mph
        const pushWatts = 125 + (level - 15) * 15;  // 125W to 200W

        return {
            type: "interval",
            sets: [{
                repeat: 1,
                intervals: [{
                    activity: "Progressive Warm-up",
                    duration: 300,
                    intensity: "building from light to moderate resistance",
                    targetMetrics: {
                        speed: "10-12",
                        cadence: "70-80",
                        watts: "60-90"
                    }
                }]
            }, {
                repeat: sets,
                intervals: [
                    {
                        activity: "Sustained Power Interval",
                        duration: pushDuration,
                        intensity: "medium-high resistance, steady cadence",
                        targetMetrics: {
                            speed: pushSpeed,
                            cadence: 80,
                            watts: pushWatts
                        }
                    },
                    {
                        activity: "Active Recovery",
                        duration: recoveryDuration,
                        intensity: "light resistance, keep legs moving",
                        targetMetrics: {
                            speed: 11,
                            cadence: 75,
                            watts: 70
                        }
                    }
                ]
            }, {
                repeat: 1,
                intervals: [{
                    activity: "Cool-down",
                    duration: 300,
                    intensity: "gradual reduction in resistance",
                    targetMetrics: {
                        speed: "10-8",
                        cadence: "70-60",
                        watts: "60-40"
                    }
                }]
            }],
            totalDuration: 300 + (pushDuration + recoveryDuration) * sets + 300,
            description: `Sustained Power Development - Level ${level}`
        };
    }
}

function formatIntervalWorkout(workout) {
    return `
        <div class="workout-header">
            <h4>${workout.description}</h4>
            <div class="metrics-grid">
                <div class="metric">
                    <span class="metric-label">Total Time</span>
                    <span class="metric-value">${Math.round(workout.totalDuration/60)} minutes</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Intervals</span>
                    <span class="metric-value">${workout.sets.map(set => 
                        `${set.repeat}x (${set.intervals.map(int => 
                            `${int.duration}s ${int.activity}`).join(" + ")})`
                    ).join("<br>")}</span>
                </div>
            </div>
        </div>

        <div class="workout-structure">
            <h5>Interval Structure</h5>
            ${workout.sets.map(set => `
                <div class="interval-set">
                    <p class="set-header">Repeat ${set.repeat} times:</p>
                    <ul class="interval-list">
                        ${set.intervals.map(interval => `
                            <li>${interval.duration} seconds ${interval.activity} at ${interval.intensity}</li>
                        `).join('')}
                    </ul>
                </div>
                
            `).join('')}
        </div>
        ${workout.type === 'interval' ? `
            <button class="start-timer-btn" onclick="startWorkoutTimer()">
                Start Timer
            </button>
        ` : ''}`;
        }

        // Main workout generation function
        function generateCardioWorkout(level, type) {
            function getPhase(level) {
                if (level <= 10) return 'basic';
                if (level <= 20) return 'intervals';
                if (level <= 30) return 'build';
                if (level <= 70) return 'endurance';
                return 'long';
            }

            const workout = {
                type,
                phase: getPhase(level)
            };

            // Workout type specific generation
            switch (type) {
                case 'run':
                    return generateRunWorkout(level, workout);
                case 'bike':
                    return generateBikeWorkout(level, workout);
                case 'swim':
                    return generateSwimWorkout(level, workout);
                case 'row':
                    return generateRowWorkout(level, workout);
                default:
                    throw new Error('Unsupported workout type');
            }
        }

        // Individual workout type generators
        function generateRunWorkout(level, workout) {
            if (level <= 10) {
                // Basic walking phase
                workout.time = 30;
                const baseSpeed = 2.5 + (level - 1) * 0.1;
                workout.distance = +(workout.time * baseSpeed / 60).toFixed(2);
                workout.pace = 60 / baseSpeed;
                workout.title = 'Walking Workout';

                const formCues = [
                    'Stand tall, shoulders relaxed',
                    'Look ahead, not down',
                    'Arms swing naturally',
                    'Push off with your toes'
                ];

                const notes = [
                    'Walk at a brisk but comfortable pace',
                    'Focus on maintaining good posture',
                    'Breathe naturally'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatFormCues(formCues)}
            ${formatNotes(notes)}
            ${formatCalories('150-300')}`;
            } else if (level <= 20) {
                // Run/Walk Intervals phase
                // These are much more complicated so they're split out into generateBeginnerRunningIntervals
                const intervals = generateBeginnerRunningIntervals(level, 'run');
                workout.title = 'Run/Walk Interval Workout';

                const formCues = [
                    'Keep your head level',
                    'Land midfoot, not heel',
                    'Elbows at 90 degrees',
                    'Relax your shoulders'
                ];

                const notes = [
                    'Maintain conversational pace during run intervals',
                    'Walk briskly during recovery',
                    'Focus on breathing rhythm',
                    'You should be able to speak in short sentences while running'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatIntervalWorkout(intervals)}
            ${formatFormCues(formCues)}
            ${formatNotes(notes)}
            ${formatCalories('200-400')}`;
            } else {
                // Continuous running phases
                const configs = {
                    build: {
                        time: 30,
                        startPace: 12,
                        paceReduction: 0.2,
                        calories: '250-450'
                    },
                    endurance: {
                        time: 45,
                        startPace: 10,
                        paceReduction: 0.025,
                        calories: '400-800'
                    },
                    long: {
                        time: 60,
                        startPace: 9,
                        paceReduction: 0.033,
                        calories: '600-1200'
                    }
                };

                const config = level <= 30 ? configs.build :
                    level <= 70 ? configs.endurance :
                        configs.long;

                workout.time = config.time;
                workout.pace = config.startPace - (level - (level <= 30 ? 21 : level <= 70 ? 31 : 71)) * config.paceReduction;
                workout.distance = +(workout.time / workout.pace).toFixed(2);
                workout.title = `${workout.phase === 'long' ? 'Long' : 'Continuous'} Run`;

                const structure = workout.phase === 'build' ? [
                    `Warm-up: 5 minutes easy pace`,
                    `Main set: ${workout.time - 10} minutes at ${formatPace(workout.pace, 'run')}`,
                    `Cool-down: 5 minutes easy pace`
                ] : workout.phase === 'endurance' ? [
                    `Warm-up: 8 minutes easy pace`,
                    `Build: 12 minutes at ${formatPace(workout.pace + 0.5, 'run')}`,
                    `Main: 15 minutes at ${formatPace(workout.pace, 'run')}`,
                    `Push: 5 minutes at ${formatPace(workout.pace - 0.5, 'run')}`,
                    `Cool-down: 5 minutes easy pace`
                ] : [
                    `Warm-up: 10 minutes easy pace`,
                    `Main set: 45 minutes at ${formatPace(workout.pace, 'run')}`,
                    `Cool-down: 5 minutes easy pace`
                ];

                const notes = [
                    'Stay hydrated throughout',
                    'Maintain steady breathing rhythm',
                    'Focus on form, especially as fatigue sets in',
                    workout.phase === 'long' ? 'Take walking breaks if needed' : 'Maintain consistent effort'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatWorkoutStructure(structure)}
            ${formatNotes(notes)}
            ${formatCalories(config.calories)}`;
            }

            return workout;
        }


        function generateBikeWorkout(level, workout) {
            if (level <= 10) {
                // Basic cycling phase
                workout.time = 30;
                workout.pace = 10 + (level - 1) * 0.2; // 10-12 mph
                workout.distance = +(workout.time * workout.pace / 60).toFixed(2);
                workout.watts = Math.round(60 + (level - 1) * 4); // 60-96 watts
                workout.title = 'Foundation Cycling';

                const formCues = [
                    'Maintain proper seat height - slight bend in knee at bottom of pedal stroke',
                    'Keep shoulders relaxed and elbows slightly bent',
                    'Look ahead, not down',
                    'Pedal in smooth circles'
                ];

                const notes = [
                    `Target cadence: 60-70 RPM`,
                    'Focus on form over speed',
                    'Adjust resistance to maintain steady effort',
                    'Stay well-hydrated throughout'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatFormCues(formCues)}
            ${formatNotes(notes)}
            ${formatCalories('100-200')}`;

            } else if (level <= 20) {
                // Interval phase
                const intervals = generateIntervals(level, 'bike');
                workout.time = Math.round((intervals.activeTime + intervals.restTime) * intervals.sets / 60);
                const fastSpeed = 14 + (level - 11) * 0.2; // 14-16 mph
                const watts = Math.round(100 + (level - 11) * 5); // 100-145 watts
                workout.title = 'Cycling Intervals';

                intervals.fastSpeed = fastSpeed;
                intervals.slowSpeed = 10; // Recovery pace
                intervals.watts = watts;

                const formCues = [
                    'Maintain form during high-intensity periods',
                    'Keep core engaged throughout',
                    'Use full pedal stroke, both push and pull',
                    'Stay seated during recovery intervals'
                ];

                const notes = [
                    'Effort level: Hard but controlled during work intervals',
                    'Recovery should feel easy',
                    `Target cadence: 80-90 RPM during work, 60-70 RPM recovery`,
                    'Adjust resistance to hit target watts/speed'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatIntervalSet(intervals)}
            ${formatFormCues(formCues)}
            ${formatNotes(notes)}
            ${formatCalories('150-300')}`;

            } else {
                // Continuous phases
                const configs = {
                    build: {
                        time: 30,
                        basePace: 14,
                        paceIncrease: 0.3,
                        baseWatts: 120,
                        wattsIncrease: 5,
                        calories: '200-400'
                    },
                    endurance: {
                        time: 45,
                        basePace: 15,
                        paceIncrease: 0.05,
                        baseWatts: 150,
                        wattsIncrease: 0.75,
                        calories: '300-600'
                    },
                    long: {
                        time: 60,
                        basePace: 16,
                        paceIncrease: 0.067,
                        baseWatts: 170,
                        wattsIncrease: 1,
                        calories: '400-800'
                    }
                };

                const config = level <= 30 ? configs.build :
                    level <= 70 ? configs.endurance :
                        configs.long;

                workout.time = config.time;
                workout.pace = config.basePace +
                    (level - (level <= 30 ? 21 : level <= 70 ? 31 : 71)) * config.paceIncrease;
                workout.distance = +(workout.time * workout.pace / 60).toFixed(2);
                workout.watts = Math.round(config.baseWatts +
                    (level - (level <= 30 ? 21 : level <= 70 ? 31 : 71)) * config.wattsIncrease);
                workout.title = workout.phase === 'long' ? 'Long Endurance Ride' : 'Sustained Power Ride';

                const structure = workout.phase === 'build' ? [
                    `Warm-up: 5 minutes easy spinning (60-70 RPM)`,
                    `Main set: ${workout.time - 10} minutes at ${workout.pace.toFixed(1)} mph (${workout.watts} watts)`,
                    `Cool-down: 5 minutes easy spinning`
                ] : workout.phase === 'endurance' ? [
                    `Warm-up: 8 minutes progressive build`,
                    `Main set: ${workout.time - 13} minutes at ${workout.pace.toFixed(1)} mph (${workout.watts} watts)`,
                    `Cool-down: 5 minutes easy spin`
                ] : [
                    `Warm-up: 10 minutes progressive build`,
                    `Main set: 45 minutes at ${workout.pace.toFixed(1)} mph (${workout.watts} watts)`,
                    `Cool-down: 5 minutes easy spin`
                ];

                const notes = [
                    `Target cadence: ${workout.phase === 'build' ? '75-85' : '85-95'} RPM`,
                    'Maintain steady power output',
                    'Stay well-hydrated throughout',
                    'Focus on smooth pedaling technique'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatWorkoutStructure(structure)}
            ${formatNotes(notes)}
            ${formatCalories(config.calories)}`;
            }

            return workout;
        }

        function generateSwimWorkout(level, workout) {
            if (level <= 10) {
                // Basic swimming phase
                workout.time = 15 + Math.floor((level - 1) * 0.5) * 5; // 15-20 minutes
                workout.title = 'Swimming Fundamentals';
                workout.restEvery = Math.max(1, 3 - Math.floor((level - 1) / 3)); // Rest after every 1-3 laps

                const formCues = [
                    'Focus on steady breathing pattern',
                    'Keep your head aligned with your spine',
                    'Long, smooth strokes',
                    'Kick from your hips, not knees'
                ];

                const notes = [
                    `Swim ${workout.restEvery} lap(s) at a time`,
                    'Rest 30-60 seconds between sets',
                    'Focus on form over speed',
                    'Take longer breaks if needed for proper form'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatFormCues(formCues)}
            ${formatNotes(notes)}
            ${formatCalories('150-300')}`;

            } else if (level <= 20) {
                // Structured intervals
                workout.time = 20 + Math.floor((level - 11) * 0.5) * 5;
                workout.title = 'Interval Swimming';
                const activeLaps = Math.floor(2 + (level - 11) / 2);
                const restSeconds = Math.max(45, 90 - (level - 11) * 5);
                workout.laps = activeLaps * 3;
                workout.distance = workout.laps * 25;
                workout.pace = Math.max(60, 90 - (level - 11) * 3);

                const structure = [
                    `3 sets of ${activeLaps} continuous laps`,
                    `Rest ${formatTime(restSeconds)} between sets`,
                    `Target pace: ${formatTime(workout.pace)} per lap`
                ];

                const formCues = [
                    'Maintain streamline position off walls',
                    'Focus on bilateral breathing',
                    'Keep steady stroke count per lap',
                    'Strong but controlled kicks'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatWorkoutStructure(structure)}
            ${formatFormCues(formCues)}
            ${formatCalories('200-400')}`;

            } else {
                // Continuous swimming phases
                const configs = {
                    build: {
                        time: 30,
                        baseLaps: 20,
                        lapIncrease: 1,
                        basePace: 60,
                        paceReduction: 1,
                        calories: '300-600'
                    },
                    endurance: {
                        time: 45,
                        baseLaps: 40,
                        lapIncrease: 0.5,
                        basePace: 45,
                        paceReduction: 0.125,
                        calories: '400-800'
                    },
                    long: {
                        time: 60,
                        baseLaps: 60,
                        lapIncrease: 0.5,
                        basePace: 40,
                        paceReduction: 0.167,
                        calories: '500-1000'
                    }
                };

                const config = level <= 30 ? configs.build :
                    level <= 70 ? configs.endurance :
                        configs.long;

                workout.time = config.time;
                workout.laps = Math.floor(config.baseLaps +
                    (level - (level <= 30 ? 21 : level <= 70 ? 31 : 71)) * config.lapIncrease);
                workout.distance = workout.laps * 25;
                workout.pace = Math.max(35, config.basePace -
                    Math.floor((level - (level <= 30 ? 21 : level <= 70 ? 31 : 71)) * config.paceReduction));
                workout.title = workout.phase === 'long' ? 'Distance Swimming' : 'Endurance Swimming';

                const structure = workout.phase === 'build' ? [
                    `Warm-up: 4 laps easy`,
                    `Main set: ${workout.laps - 8} laps at ${formatTime(workout.pace)} per lap`,
                    `Cool-down: 4 laps easy`
                ] : workout.phase === 'endurance' ? [
                    `Warm-up: 6 laps easy`,
                    `Main set: ${workout.laps - 10} laps at ${formatTime(workout.pace)} per lap`,
                    `Cool-down: 4 laps easy`
                ] : [
                    `Warm-up: 8 laps easy`,
                    `Main set: ${workout.laps - 12} laps at ${formatTime(workout.pace)} per lap`,
                    `Cool-down: 4 laps easy`
                ];

                const notes = [
                    'Maintain consistent stroke count',
                    'Focus on efficient turns',
                    'Breathe every 2-3 strokes as needed',
                    'Take short breaks if form deteriorates'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatWorkoutStructure(structure)}
            ${formatNotes(notes)}
            ${formatCalories(config.calories)}`;
            }

            return workout;
        }

        function generateRowWorkout(level, workout) {
            if (level <= 10) {
                // Foundation phase focusing on technique
                workout.time = 15 + Math.floor((level - 1) * 0.5) * 5; // Progressive build from 15-20 minutes
                workout.title = 'Rowing Technique Foundation';

                // Calculate interval structure that allows focus on form
                const activeMinutes = Math.min(3, 1 + Math.floor((level - 1) / 2));
                const restMinutes = Math.max(1, 3 - Math.floor((level - 1) / 3));
                workout.spm = 18 + Math.floor((level - 1) / 2); // Stroke rate progresses from 18-22 SPM

                const formCues = [
                    'Sequence: legs-back-arms for drive, arms-back-legs for recovery',
                    'Keep arms straight during the initial drive',
                    'Core engaged throughout the stroke',
                    `Maintain ${workout.spm} strokes per minute for control`
                ];

                const structure = [
                    `Row for ${activeMinutes} minutes`,
                    'Rest and stretch for ${restMinutes} minutes',
                    'Repeat until time complete'
                ];

                const notes = [
                    'Focus on perfect form over power',
                    'Watch the force curve on the monitor',
                    'Keep shoulders relaxed and low',
                    'Take extra rest if form deteriorates'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatWorkoutStructure(structure)}
            ${formatFormCues(formCues)}
            ${formatNotes(notes)}
            ${formatCalories('100-250')}`;

            } else if (level <= 20) {
                // Interval phase introducing split times
                workout.time = 20 + (level - 11);
                workout.title = 'Power Development Intervals';

                // Calculate progressive targets
                workout.pace = Math.max(150, 180 - (level - 11) * 3); // Split time progresses from 3:00 to 2:30 /500m
                const activeMinutes = Math.floor(2 + (level - 11) / 2);
                const restSeconds = Math.max(60, 120 - (level - 11) * 6);
                workout.spm = 20 + Math.floor((level - 11) / 2); // SPM progresses from 20-24

                // Calculate total distance based on split time
                const timeInSeconds = workout.time * 60;
                workout.distance = Math.round((timeInSeconds / workout.pace) * 500 * 0.6); // Accounting for rest periods

                const structure = [
                    `${Math.floor(workout.time / (activeMinutes + restSeconds / 60))} sets of:`,
                    `${activeMinutes} minutes at ${formatTime(workout.pace)}/500m`,
                    `${formatTime(restSeconds)} rest between sets`
                ];

                const formCues = [
                    `Hold ${workout.spm} SPM during work intervals`,
                    'Drive through the heels',
                    'Quick hands away from finish',
                    'Control the slide during recovery'
                ];

                const notes = [
                    'Focus on power application during drive',
                    'Use rest periods for light stretching',
                    'Monitor split time consistency',
                    'Stay relaxed during recovery phase'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatWorkoutStructure(structure)}
            ${formatFormCues(formCues)}
            ${formatNotes(notes)}
            ${formatCalories('150-350')}`;

            } else {
                // Endurance and long-distance phases
                const configs = {
                    build: {
                        time: 30,
                        basePace: 150,
                        paceReduction: 3,
                        baseSPM: 22,
                        spmIncrease: 0.5,
                        calories: '250-500'
                    },
                    endurance: {
                        time: 45,
                        basePace: 120,
                        paceReduction: 0.25,
                        baseSPM: 24,
                        spmIncrease: 0.2,
                        calories: '350-700'
                    },
                    long: {
                        time: 60,
                        basePace: 105,
                        paceReduction: 0.33,
                        baseSPM: 26,
                        spmIncrease: 0.15,
                        calories: '450-900'
                    }
                };

                const config = level <= 30 ? configs.build :
                    level <= 70 ? configs.endurance :
                        configs.long;

                workout.time = config.time;
                workout.pace = Math.max(90, config.basePace -
                    Math.floor((level - (level <= 30 ? 21 : level <= 70 ? 31 : 71)) * config.paceReduction));
                workout.spm = Math.min(32, Math.floor(config.baseSPM +
                    (level - (level <= 30 ? 21 : level <= 70 ? 31 : 71)) * config.spmIncrease));

                // Calculate distance based on split time
                workout.distance = Math.round((workout.time * 60 / workout.pace) * 500);
                workout.title = workout.phase === 'long' ? 'Long Distance Row' : 'Endurance Development';

                // Create pyramid structure for advanced workouts
                const baseSplit = workout.pace;
                const hardSplit = Math.max(baseSplit - 10, baseSplit * 0.9);
                const easySplit = baseSplit + 15;

                let structure;
                if (workout.phase === 'build') {
                    structure = [
                        `Warm-up: 5 minutes at ${formatTime(easySplit)}/500m`,
                        `Main set: ${workout.time - 10} minutes at ${formatTime(baseSplit)}/500m`,
                        `Cool-down: 5 minutes at ${formatTime(easySplit)}/500m`
                    ];
                } else if (workout.phase === 'endurance') {
                    structure = [
                        `Warm-up: 5 minutes at ${formatTime(easySplit)}/500m`,
                        `3 x 10 minutes at ${formatTime(baseSplit)}/500m`,
                        `2 x 5 minutes at ${formatTime(hardSplit)}/500m`,
                        `Cool-down: 5 minutes at ${formatTime(easySplit)}/500m`
                    ];
                } else {
                    structure = [
                        `Warm-up: 5 minutes at ${formatTime(easySplit)}/500m`,
                        `4 x 10 minutes at ${formatTime(baseSplit)}/500m`,
                        `3 x 3 minutes at ${formatTime(hardSplit)}/500m`,
                        `1 minute easy between hard intervals`,
                        `Cool-down: 5 minutes at ${formatTime(easySplit)}/500m`
                    ];
                }

                const notes = [
                    `Maintain ${workout.spm} SPM during main sets`,
                    'Focus on efficiency at higher rates',
                    'Stay relaxed through the upper body',
                    'Monitor heart rate and adjust intensity if needed'
                ];

                workout.html = `
            ${formatWorkoutHeader(workout)}
            ${formatWorkoutStructure(structure)}
            ${formatNotes(notes)}
            ${formatCalories(config.calories)}`;
            }

            return workout;
        }

        function generateStrengthWorkout(level) {
            // Helper function to round weight to nearest 5 lbs
            function roundWeight(weight) {
                return Math.round(weight / 5) * 5;
            }

            // Helper function to round time to nearest 15 seconds
            function roundTime(seconds) {
                return Math.round(seconds / 15) * 15;
            }

            const workout = {
                title: level <= 10 ? 'Foundation Strength Training' :
                    level <= 20 ? 'Basic Machine Circuit' :
                        'Progressive Machine Training',
                exercises: []
            };

            // Bodyweight exercises for beginners (levels 1-10)
            if (level <= 10) {
                workout.exercises = [
                    {
                        name: "Wall Push-ups",
                        description: "Stand facing a wall at arm's length. Place hands on wall at shoulder height and width. Bend arms to bring chest toward wall, then push back.",
                        sets: 2,
                        reps: Math.min(5 + Math.floor(level / 2), 12),
                        type: "bodyweight",
                        targetMuscles: "Chest, shoulders, triceps"
                    },
                    {
                        name: "Supported Squats",
                        description: "Hold onto a sturdy chair or rail. Stand with feet shoulder-width apart. Lower yourself as if sitting back into a chair, then stand.",
                        sets: 2,
                        reps: Math.min(6 + Math.floor(level / 2), 15),
                        type: "bodyweight",
                        targetMuscles: "Legs, glutes"
                    },
                    {
                        name: "Seated Row Machine",
                        description: "Sit at row machine with feet on platform. Grasp handles and pull towards torso while keeping back straight.",
                        sets: 2,
                        reps: 10,
                        weight: roundWeight(20 + level * 2.5),
                        type: "machine",
                        targetMuscles: "Upper back, biceps"
                    },
                    {
                        name: "Modified Plank",
                        description: "Place forearms on ground with knees down. Keep body straight from head to knees.",
                        duration: roundTime(20 + level * 5),
                        type: "bodyweight",
                        targetMuscles: "Core"
                    }
                ];
            }
            // Transition to machines (levels 11-20)
            else if (level <= 20) {
                workout.exercises = [
                    {
                        name: "Leg Press Machine",
                        description: "Sit in machine with feet shoulder-width on platform. Push platform away by extending legs, then slowly return.",
                        sets: 3,
                        reps: 12,
                        weight: roundWeight(50 + (level - 10) * 5),
                        type: "machine",
                        targetMuscles: "Legs, glutes"
                    },
                    {
                        name: "Chest Press Machine",
                        description: "Sit in machine with handles at chest height. Push handles forward until arms extend, then slowly return.",
                        sets: 3,
                        reps: 12,
                        weight: roundWeight(30 + (level - 10) * 5),
                        type: "machine",
                        targetMuscles: "Chest, shoulders, triceps"
                    },
                    {
                        name: "Lat Pulldown Machine",
                        description: "Sit facing machine, grasp overhead bar wider than shoulders. Pull bar down to upper chest, then slowly return.",
                        sets: 3,
                        reps: 12,
                        weight: roundWeight(40 + (level - 10) * 5),
                        type: "machine",
                        targetMuscles: "Back, biceps"
                    },
                    {
                        name: "Leg Extension Machine",
                        description: "Sit in machine with ankles behind pad. Straighten legs to raise weight, then slowly lower.",
                        sets: 2,
                        reps: 15,
                        weight: roundWeight(30 + (level - 10) * 5),
                        type: "machine",
                        targetMuscles: "Front thigh muscles"
                    },
                    {
                        name: "Plank",
                        description: "Place forearms on ground with toes tucked. Keep body straight from head to heels.",
                        duration: roundTime(30 + (level - 10) * 10),
                        type: "bodyweight",
                        targetMuscles: "Core"
                    }
                ];
            }
            // Progressive machine work (levels 21+)
            else {
                workout.exercises = [
                    {
                        name: "Leg Press Machine",
                        description: "Sit in machine with feet shoulder-width on platform. Push platform away by extending legs, then slowly return.",
                        sets: 3,
                        reps: 12,
                        weight: roundWeight(100 + (level - 20) * 5),
                        type: "machine",
                        targetMuscles: "Legs, glutes"
                    },
                    {
                        name: "Chest Press Machine",
                        description: "Sit in machine with handles at chest height. Push handles forward until arms extend, then slowly return.",
                        sets: 3,
                        reps: 12,
                        weight: roundWeight(80 + (level - 20) * 5),
                        type: "machine",
                        targetMuscles: "Chest, shoulders, triceps"
                    },
                    {
                        name: "Lat Pulldown Machine",
                        description: "Sit facing machine, grasp overhead bar wider than shoulders. Pull bar down to upper chest, then slowly return.",
                        sets: 3,
                        reps: 12,
                        weight: roundWeight(90 + (level - 20) * 5),
                        type: "machine",
                        targetMuscles: "Back, biceps"
                    },
                    {
                        name: "Seated Row Machine",
                        description: "Sit at row machine with feet on platform. Grasp handles and pull towards torso while keeping back straight.",
                        sets: 3,
                        reps: 12,
                        weight: roundWeight(85 + (level - 20) * 5),
                        type: "machine",
                        targetMuscles: "Upper back, biceps"
                    },
                    {
                        name: "Triceps Pushdown Machine",
                        description: "Stand facing machine, grasp overhead bar. Push bar down by straightening arms, then slowly return.",
                        sets: 3,
                        reps: 15,
                        weight: roundWeight(40 + (level - 20) * 2.5),
                        type: "machine",
                        targetMuscles: "Triceps"
                    },
                    {
                        name: "Plank",
                        description: "Place forearms on ground with toes tucked. Keep body straight from head to heels.",
                        duration: roundTime(60 + (level - 20) * 5),
                        type: "bodyweight",
                        targetMuscles: "Core"
                    }
                ];
            }

            // Generate HTML similar to cardio section
            workout.html = `
        <div class="workout-header">
            <h4>${workout.title}</h4>
        </div>
        ${workout.exercises.map(exercise => `
            <div class="exercise-card">
                <h5>${exercise.name}</h5>
                <div class="exercise-description">
                    <p>${exercise.description}</p>
                    <p class="target-muscles">Target: ${exercise.targetMuscles}</p>
                </div>
                <div class="exercise-details">
                    ${exercise.sets ? `<p>Sets: ${exercise.sets}</p>` : ''}
                    ${exercise.reps ? `<p>Reps: ${exercise.reps}</p>` : ''}
                    ${exercise.weight ? `<p>Weight: ${exercise.weight} lbs</p>` : ''}
                    ${exercise.duration ? `<p>Duration: ${Math.floor(exercise.duration / 60)}:${(exercise.duration % 60).toString().padStart(2, '0')}</p>` : ''}
                </div>
            </div>
        `).join('')}
        <div class="workout-notes">
            <h5>Important Notes</h5>
            <ul>
                <li>Start with a light warm-up of 5-10 minutes on a cardio machine</li>
                <li>Focus on proper form rather than heavy weights</li>
                <li>Rest 60-90 seconds between sets</li>
                <li>If you're unsure about any machine, ask gym staff for assistance</li>
            </ul>
        </div>`;

            return workout;
        }

        function updateStrengthContent() {
            const workout = generateStrengthWorkout(levels.strength);
            const content = document.getElementById('strengthContent');
            content.innerHTML = workout.html;
        }



        function updateCardioContent() {
            const workout = generateCardioWorkout(levels.cardio, currentCardioType);
            const content = document.getElementById('cardioContent');

            // The workout generators store the formatted HTML in workout.html
            content.innerHTML = `
        <div class="exercise-card">
            ${workout.html}
        </div>
    `;
        }


        function getSpecialNotes(level) {
    // Create groups of notes that make sense together
    const noteGroups = [
        // Absolute Beginner Notes (Levels 1-5)
        [
            "Your muscles' natural tension in the morning differs from evening - notice these patterns to understand your body's rhythms.",
            "A proper stretch feels like a gentle pulling sensation, never sharp pain. Think of slowly stretching a rubber band.",
            "The exhale phase of your breath naturally allows for slightly deeper stretches - try focusing on this connection."
        ],
        // Early Form Notes (Levels 6-10)
        [
            "Imagine creating length through your spine as you stretch - this helps maintain proper alignment.",
            "Your body may feel different each day. This natural variation is perfectly normal and guides how deeply to stretch.",
            "Focus on relaxing the muscles you're stretching - tension often comes from muscles trying to protect themselves."
        ],
        // Body Awareness Notes (Levels 11-15)
        [
            "Notice which side of your body feels tighter - this awareness helps prevent overcompensating.",
            "The sensation of a stretch should remain steady - if it lessens while holding, you can carefully deepen the position.",
            "Pay attention to your jaw and shoulders - we often hold tension here without realizing it."
        ],
        // Intermediate Foundation (Levels 16-20)
        [
            "Try to identify which specific muscles feel tight during each stretch - this body awareness aids progress.",
            "Quality of movement matters more than depth - focus on smooth, controlled transitions.",
            "Your flexibility naturally fluctuates throughout the day - morning stiffness is completely normal."
        ],
        // Intermediate Progress (Levels 21-30)
        [
            "Balanced flexibility requires both stretching and strengthening - the two work together.",
            "Notice how your breathing pattern affects the depth of your stretches.",
            "Rather than pushing harder, try relaxing deeper into each position."
        ],
        // Intermediate Mastery (Levels 31-40)
        [
            "Small adjustments in alignment can dramatically change which muscles you feel stretching.",
            "Consider how your daily activities affect your flexibility patterns.",
            "Focus on maintaining relaxed breathing even in challenging positions."
        ],
        // Advanced Foundation (Levels 41-60)
        [
            "Flexibility gains come from consistent practice, not from forcing extreme positions.",
            "Pay attention to the quality of the stretch sensation - sharp or burning feelings indicate too much intensity.",
            "Your nervous system needs time to adapt - patience leads to lasting progress."
        ],
        // Advanced Development (Levels 61-80)
        [
            "Notice how proper alignment allows for deeper stretches with less effort.",
            "Even at advanced levels, never force a stretch - control and awareness remain crucial.",
            "Regular gentle stretching often yields better results than occasional intense sessions."
        ],
        // Advanced Mastery (Levels 81-100)
        [
            "Maintain awareness of your entire body even while focusing on specific stretches.",
            "Your flexibility journey is unique - avoid comparing yourself to others.",
            "Listen to subtle feedback from your body - it guides optimal stretch intensity."
        ]
    ];

    // Determine which group of notes to use based on level
    let groupIndex = Math.floor((level - 1) / 5);
    groupIndex = Math.min(groupIndex, noteGroups.length - 1);

    // Within each group, rotate through different combinations of notes
    // based on level to keep the advice fresh
    const currentGroup = noteGroups[groupIndex];
    const rotationIndex = level % 3; // Cycle through different combinations

    // Select three notes using different rotation patterns
    let selectedNotes;
    switch(rotationIndex) {
        case 0:
            selectedNotes = [currentGroup[0], currentGroup[1], currentGroup[2]];
            break;
        case 1:
            selectedNotes = [currentGroup[2], currentGroup[0], currentGroup[1]];
            break;
        case 2:
            selectedNotes = [currentGroup[1], currentGroup[2], currentGroup[0]];
            break;
        default:
            selectedNotes = currentGroup.slice(0, 3);
    }

    return selectedNotes;
}

        function generateFlexWorkout(level) {
            const workout = {
                title: level <= 20 ? 'Basic Flexibility Training' :
                    level <= 50 ? 'Intermediate Stretching' :
                        'Advanced Flexibility Work',
                description: "Hold each stretch until you feel a gentle pull - never stretch to the point of pain. Breathe slowly and deeply while stretching.",
                stretches: []
            };

            // Define the current goal based on level
            function getCurrentGoal(level) {
                const goals = [
                    { level: 5, description: "Touch your knees while standing with straight legs" },
                    { level: 10, description: "Touch your shins while standing with straight legs" },
                    { level: 15, description: "Hold a toe touch with bent knees for 30 seconds" },
                    { level: 20, description: "Touch your toes while standing with slightly bent knees" },
                    { level: 30, description: "Touch your toes while standing with straight legs" },
                    { level: 40, description: "Place palms flat on floor with bent knees" },
                    { level: 50, description: "Hold a seated forward fold, touching toes, for 60 seconds" },
                    { level: 60, description: "Place palms flat on floor with straight legs" },
                    { level: 70, description: "Achieve a runner's lunge with back knee on ground" },
                    { level: 80, description: "Hold a front split with support (blocks or cushions)" },
                    { level: 90, description: "Achieve a full front split on one side" },
                    { level: 100, description: "Achieve full front splits on both sides" }
                ];

                // Find the next goal to work toward
                let nextGoal = goals.find(goal => goal.level > level) || goals[goals.length - 1];
                let currentGoal = goals.find(goal => goal.level <= level);

                // For display purposes, show the last achieved goal and the next goal
                return {
                    current: currentGoal ? currentGoal.description : goals[0].description,
                    next: nextGoal.description,
                    progress: currentGoal ? `Level ${currentGoal.level} goal achieved!` : "Working toward first goal"
                };
            }

            // Basic stretches that everyone starts with
            // Beginner level (1-20) with highly detailed progression and guidance
            if (level <= 20) {
                workout.stretches = [
                    {
                        name: "Standing Forward Reach",
                        description: "Stand with feet hip-width apart. Keeping your legs mostly straight but not locked, slowly bend forward and reach down toward your feet. Only go as far as comfortable - you might only reach your thighs at first, and that's perfectly fine.",
                        duration: level <= 5 ? "15 seconds" :
                            level <= 10 ? "20 seconds" : "30 seconds",
                        target: "Back of legs (hamstrings) and lower back",
                        goal: level <= 5 ? "Reach fingertips to mid-thigh while keeping back straight - focus on feeling a gentle stretch in the backs of your legs" :
                            level <= 8 ? "Reach fingertips past mid-thigh. Your back can round slightly, but you should still be able to breathe comfortably" :
                                level <= 12 ? "Touch your fingertips to your kneecaps. Try to keep your legs as straight as possible, but a slight bend is fine" :
                                    level <= 15 ? "Reach your fingertips to the top of your shins. Notice how your breathing affects the stretch" :
                                        level <= 18 ? "Touch your fingers to the middle of your shins. Focus on relaxing your neck and shoulders" :
                                            "Reach for your ankles. Remember - it's not about touching them yet, just reaching toward them with control"
                    },
                    {
                        name: "Gentle Seated Twist",
                        description: "Sit in a chair with feet flat on floor. Keep your back straight and shoulders relaxed. Slowly turn to look over one shoulder, using the chair back or your hands on your legs to help.",
                        duration: level <= 7 ? "10 seconds each side" :
                            level <= 15 ? "15 seconds each side" :
                                "20 seconds each side",
                        target: "Upper back and spine mobility",
                        goal: level <= 5 ? "Turn just until you feel the first hint of stretch - notice where you feel it in your back" :
                            level <= 10 ? "Turn far enough to look past your shoulder, keeping your head level" :
                                level <= 15 ? "Turn far enough to see the wall behind you while keeping hips facing forward" :
                                    "Turn far enough to grasp the chair back with both hands, keeping your spine tall"
                    },
                    {
                        name: "Wall Calf Stretch",
                        description: "Stand facing a wall, place hands flat on wall at shoulder height. Step one foot back and press heel down. Keep back leg straight but not locked. If this is too intense, bend your back leg slightly.",
                        duration: level <= 8 ? "15 seconds each leg" :
                            level <= 15 ? "20 seconds each leg" :
                                "30 seconds each leg",
                        target: "Lower leg muscles (calves)",
                        goal: level <= 5 ? "Focus on feeling the stretch with your back heel just barely touching the ground" :
                            level <= 10 ? "Press your heel fully into the ground, even if you need to move closer to the wall" :
                                level <= 15 ? "Keep heel down while gradually moving foot farther from wall" :
                                    "Hold with foot farther from wall while keeping heel flat and leg straight"
                    },
                    {
                        name: "Assisted Knee Hug",
                        description: "Lie on your back with legs extended. Bend one knee and bring it toward your chest, using your hands clasped behind your thigh to help. Keep your other leg straight on the ground.",
                        duration: level <= 6 ? "15 seconds each leg" :
                            level <= 12 ? "20 seconds each leg" :
                                "30 seconds each leg",
                        target: "Lower back and hip mobility",
                        goal: level <= 4 ? "Lift knee enough to feel gentle stretch while keeping head and shoulders relaxed on floor" :
                            level <= 8 ? "Draw knee closer to chest while keeping other leg straight on ground" :
                                level <= 12 ? "Pull knee toward chest until thigh touches belly, if comfortable" :
                                    level <= 16 ? "Keep lower back pressed against floor while hugging knee" :
                                        "Hold knee to chest while completely relaxing hip muscles"
                    },
                    {
                        name: "Shoulder Circles",
                        description: "Stand or sit tall. Slowly roll shoulders forward, up, back, and down in a circular motion. Then reverse the direction. Keep the movements slow and controlled.",
                        duration: level <= 10 ? "5 circles each direction" :
                            level <= 15 ? "8 circles each direction" :
                                "10 circles each direction",
                        target: "Shoulder mobility and tension relief",
                        goal: level <= 5 ? "Focus on making the circles as smooth as possible, even if they're small" :
                            level <= 10 ? "Make the circles larger while keeping shoulders relaxed" :
                                level <= 15 ? "Feel shoulder blades moving through their full range" :
                                    "Make large circles while keeping neck relaxed and spine straight"
                    }
                ];

            }

            // Intermediate level (21-50) now has more targeted goals
            else if (level <= 50) {
                workout.stretches = [
                    {
                        name: "Seated Forward Reach",
                        description: "Sit on floor with legs straight out front. Keeping back straight, reach forward toward your toes. Let your head hang relaxed. Again, reaching your toes isn't necessary - go only as far as comfortable.",
                        duration: "45 seconds",
                        target: "Back of legs and lower back",
                        goal: "Hold position without rounding your lower back"
                    },
                    {
                        name: "Floor Twist",
                        description: "Sit on floor with one leg straight, other leg bent with foot flat on floor outside opposite knee. Twist torso toward bent knee, using arm to help hold the twist. Keep back straight.",
                        duration: "30 seconds each side",
                        target: "Back and hips",
                        goal: "Look completely behind you while keeping hips grounded"
                    },
                    {
                        name: "Extended Kneeling Hip Stretch",
                        description: "Kneel on one knee (put a cushion under knee if needed). Push hips forward slightly while keeping torso upright. For more stretch, raise arm on same side as back leg.",
                        duration: "30 seconds each side",
                        target: "Hip flexors, quads, and shoulders",
                        goal: "Maintain upright posture without leaning forward"
                    },
                    {
                        name: "Wide-Legged Seated Forward Fold",
                        description: "Sit with legs spread wide. Keeping legs straight but not locked, walk hands forward between legs. Let head hang relaxed.",
                        duration: "45 seconds",
                        target: "Inner thighs and hamstrings",
                        goal: level <= 35 ? "Keep back flat while reaching forward" :
                            level <= 45 ? "Touch elbows to ground" :
                                "Bring chest closer to ground"
                    },
                    {
                        name: "Figure-Four Hip Stretch",
                        description: "Lie on back, cross right ankle over left thigh. Thread hands behind left thigh and gently pull leg toward chest. Keep head and shoulders relaxed on floor.",
                        duration: "40 seconds each side",
                        target: "Deep hip muscles and glutes",
                        goal: "Keep bottom foot flexed and hips relaxed"
                    }
                ];
            }
            // Advanced level (51-100) with progressive goals
            else {
                workout.stretches = [
                    {
                        name: "Advanced Forward Fold",
                        description: "Stand with feet hip-width apart. Bend forward, reaching for the ground. Bend knees only if needed for comfort.",
                        duration: "60 seconds",
                        target: "Entire back of body",
                        goal: level <= 70 ? "Place full palms on floor beside feet" :
                            level <= 85 ? "Hold palms flat while straightening legs" :
                                "Bring forehead toward knees with straight legs"
                    },
                    {
                        name: "Front Split Preparation",
                        description: "Starting in a low lunge, gradually slide front leg forward and back leg back. Use yoga blocks or cushions under hands for support if needed.",
                        duration: "60 seconds each side",
                        target: "Hip flexors and hamstrings",
                        goal: level <= 65 ? "Lower hips with both legs straight" :
                            level <= 80 ? "Get hips 6 inches from ground with support" :
                                level <= 90 ? "Achieve full split with light support" :
                                    "Hold full split without support"
                    },
                    {
                        name: "Middle Split Preparation",
                        description: "Stand with feet wide, toes pointing forward. Gradually lower hips while sliding feet wider. Keep hands on floor in front for support.",
                        duration: "45 seconds",
                        target: "Inner thighs and hips",
                        goal: level <= 60 ? "Keep pelvis tucked while lowering" :
                            level <= 75 ? "Thighs parallel to ground" :
                                level <= 85 ? "Hips 8 inches from ground" :
                                    "Work toward full middle split"
                    },
                    {
                        name: "Bridge Position",
                        description: "Lie on back, bend knees with feet flat on floor. Press hips up, then bring hands by ears and press up into a backbend if comfortable.",
                        duration: "45 seconds",
                        target: "Spine, shoulders, and hip flexors",
                        goal: level <= 70 ? "Lift hips with straight arms" :
                            level <= 85 ? "Straighten arms in bridge" :
                                "Work on walking hands closer to feet"
                    },
                    {
                        name: "Advanced Hip Opener",
                        description: "From seated position, bend knees and bring soles of feet together. Let knees fall out to sides. Slowly fold forward while keeping back straight.",
                        duration: "60 seconds",
                        target: "Inner thighs and hips",
                        goal: level <= 65 ? "Keep back straight while folding" :
                            level <= 80 ? "Bring forehead toward feet" :
                                "Press knees closer to ground"
                    }
                ];
            }

            workout.specialNotes = getSpecialNotes(level);
            const goal = getCurrentGoal(level);

            workout.html = `
        <div class="workout-header">
            <h4>${workout.title}</h4>
            <p class="workout-intro">${workout.description}</p>
        </div>

        <div class="exercise-card goal-card">
            <h5>Your Flexibility Journey</h5>
            <div class="goal-progress">
                <div class="current-goal">
                    <span class="goal-label">Current Achievement:</span>
                    <span class="goal-text">${goal.current}</span>
                </div>
                <div class="next-goal">
                    <span class="goal-label">Working Toward:</span>
                    <span class="goal-text">${goal.next}</span>
                </div>
                <div class="progress-marker">
                    <span class="progress-text">${goal.progress}</span>
                </div>
            </div>
        </div>
        

    ${workout.specialNotes ? `
        <div class="exercise-card special-notes">
            <h5>Today's Focus Points</h5>
            <ul class="notes-list">
                ${workout.specialNotes.map(note => `
                    <li class="note-item">${note}</li>
                `).join('')}
            </ul>
        </div>
    ` : ''}

        ${workout.stretches.map(stretch => `
            <div class="exercise-card stretch-card">
                <h5>${stretch.name}</h5>
                <div class="stretch-description">
                    <p>${stretch.description}</p>
                </div>
                <div class="stretch-details">
                    <p class="target-area">Target Area: ${stretch.target}</p>
                    <p class="duration">Hold for: ${stretch.duration}</p>
                    ${stretch.goal ? `<p class="stretch-goal">Today's Goal: ${stretch.goal}</p>` : ''}
                </div>
            </div>
        `).join('')}

        
        <div class="workout-notes">
            <h5>Important Reminders</h5>
            <ul>
                <li>Never bounce or force a stretch</li>
                <li>Stretch only to the point of mild tension, never pain</li>
                <li>Breathe slowly and steadily throughout each stretch</li>
                <li>If you have any injuries or medical conditions, consult your doctor first</li>
            </ul>
        </div>`;

            return workout;
        }

        // Add these functions to handle the timer integration
function workoutToTimerIntervals(workout) {
    let timerIntervals = [];
    
    // Add warm-up if present
    if (workout.sets[0]?.intervals[0]?.activity === "Warm-up Walk") {
        timerIntervals.push({
            activity: "Warm-up Walk",
            duration: workout.sets[0].intervals[0].duration,
        });
    }
    
    // Add main workout intervals
    const mainSet = workout.sets.find(set => set.repeat > 1);
    if (mainSet) {
        for (let i = 0; i < mainSet.repeat; i++) {
            mainSet.intervals.forEach(interval => {
                timerIntervals.push({
                    activity: interval.activity,
                    duration: interval.duration,
                });
            });
        }
    }
    
    // Add cool-down if present
    const lastSet = workout.sets[workout.sets.length - 1];
    if (lastSet?.intervals[0]?.activity === "Cool-down Walk") {
        timerIntervals.push({
            activity: "Cool-down Walk",
            duration: lastSet.intervals[0].duration,
        });
    }
    
    return timerIntervals;
}

function startWorkoutTimer() {
    // Get the current workout
    const workout = generateBeginnerRunningIntervals(levels.cardio);
    
    // Convert workout to timer intervals
    const timerIntervals = workoutToTimerIntervals(workout);
    
    // Hide main app and show timer
    document.querySelector('.container').style.display = 'none';
    document.querySelector('.timer-view').style.display = 'flex';
    
    // Initialize and start timer
    const timer = new IntervalTimer();
    timer.setWorkout(timerIntervals);
    
    // Set up exit handler
    document.querySelector('.exit').onclick = () => {
        // Hide timer and show main app
        document.querySelector('.timer-view').style.display = 'none';
        document.querySelector('.container').style.display = 'block';
        
        // Reset timer
        timer.reset();
    };
}

        function updateFlexContent() {
            const workout = generateFlexWorkout(levels.flex);
            const content = document.getElementById('flexContent');
            content.innerHTML = workout.html;
        }



        function updateContent() {
            updateCardioContent();
            updateStrengthContent();
            updateFlexContent();
        }

        // Initial content update
        updateContent();
    </script>
</body>

</html>