<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Level Up!</title>
    <style>
        :root {
            --primary: #FF5733;
            --secondary: #33B5FF;
            --success: #4CAF50;
            --dark: #2C3E50;
            --light: #ECF0F1;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            gap: 10px;
            background: var(--light);
            padding: 10px;
            border-radius: 15px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: white;
            font-size: 16px;
            font-weight: bold;
            color: var(--dark);
            border-radius: 10px;
            transition: all 0.3s ease;
            flex: 1 1 auto;
            min-width: 100px;
            text-align: center;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .content.active {
            display: block;
        }

        .level-selector {
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--light);
            padding: 15px;
            border-radius: 12px;
        }

        .level-control {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .level-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .level-btn:active {
            transform: scale(0.95);
        }

        input[type="range"] {
            flex: 1;
            height: 10px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--secondary);
            border-radius: 50%;
            cursor: pointer;
        }

        .level-display {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            min-width: 50px;
            text-align: center;
        }

        .cardio-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .cardio-nav button {
            padding: 12px;
            border: none;
            background-color: var(--light);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .cardio-nav button.active {
            background-color: var(--secondary);
            color: white;
            transform: scale(1.05);
        }

        .exercise-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--primary);
        }

        .exercise-card h3 {
            color: var(--primary);
            margin-top: 0;
        }

        .milestone {
            color: var(--success);
            font-weight: bold;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            margin: 10px 0;
        }

        .calories {
            display: inline-block;
            padding: 5px 10px;
            background: var(--success);
            color: white;
            border-radius: 15px;
            font-size: 14px;
            margin-top: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric {
            background: var(--light);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary);
        }

        .workout-instruction {
            font-size: 1.1em;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .exercise-card h4 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .exercise-card h5 {
            color: var(--dark);
            margin: 20px 0 10px 0;
        }

        .exercise-card p {
            margin: 15px 0;
            line-height: 1.4;
        }

        .exercise-card ul,
        .exercise-card ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .exercise-card li {
            margin: 8px 0;
        }

        .recovery-note {
            background: var(--light);
            padding: 10px;
            border-radius: 6px;
            margin-top: 20px;
        }


        .goal-card {
            background-color: var(--light);
            border-left: 5px solid var(--success);
        }

        .goal-progress {
            padding: 15px;
        }

        .goal-label {
            font-weight: bold;
            color: var(--dark);
            margin-right: 10px;
        }

        .goal-text {
            color: var(--primary);
        }

        .progress-marker {
            margin-top: 10px;
            padding: 5px 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 4px;
        }

        .stretch-goal {
            color: var(--success);
            font-style: italic;
            margin-top: 10px;
        }

        .special-notes {
            background-color: var(--light);
            border-left: 5px solid var(--secondary);
            margin-bottom: 20px;
        }

        .notes-list {
            margin: 10px 0;
            padding-left: 20px;
        }

        .note-item {
            margin: 8px 0;
            line-height: 1.4;
            color: var(--dark);
        }

        .timer-container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
        }

        .time-display {
            font-size: 72px;
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
            font-variant-numeric: tabular-nums;
        }

        .interval-info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--light);
        }

        .current-activity {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .next-up {
            font-size: 16px;
            color: #666;
            margin: 5px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--secondary);
            transition: width 1s linear;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.95);
        }

        .play-pause {
            background-color: var(--success);
            color: white;
        }

        .skip {
            background-color: var(--secondary);
            color: white;
            /* Inherits other button styles */
        }

        .skip.next-style {
            background-color: #4338CA;
            /* Different color for Next */
        }

        .reset {
            background-color: var(--secondary);
            color: white;
        }

        .exit {
            background-color: var(--primary);
            color: white;
        }

        .workout-progress {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        @media (max-width: 480px) {
            .time-display {
                font-size: 48px;
            }

            .current-activity {
                font-size: 20px;
            }
        }

        .timer-view {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* Add a Start Timer button style */
        .start-timer-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* USED FOR ROWING - TODO duplicate names i think */
        .target-metrics {
            color: #666;
            font-size: 0.9em;
            font-style: italic;
        }

        .interval-list li {
            margin-bottom: 15px;
        }

        .description {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.9em;
        }



        .swim-sets {
            margin: 20px 0;
        }

        .repeat-header {
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0 10px 0;
        }

        .swim-interval {
            background: var(--light);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .interval-main {
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .interval-intensity {
            color: var(--secondary);
            font-weight: 500;
        }

        .interval-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        /* NEW Workout Overview HTML */
        .workout-overview {
            max-width: 800px;
            margin: 0 auto;
            padding: 16px;
        }

        .overview-header {
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .workout-title {
            font-size: clamp(24px, 8vw, 36px);
            font-weight: 800;
            margin: 0 0 8px 0;
        }

        .workout-meta {
            font-size: clamp(14px, 4vw, 18px);
            font-weight: 600;
            opacity: 0.9;
        }

        .set-container {
            margin-bottom: 32px;
        }

        .repeat-container {
            border-left: 4px solid currentColor;
            margin-left: 12px;
            padding-left: 20px;
            margin-bottom: 32px;
        }

        .repeat-header {
            font-weight: 800;
            font-size: clamp(16px, 5vw, 20px);
            margin: -4px 0 16px -24px;
            padding: 8px 16px;
            border-radius: 0 8px 8px 0;
            display: inline-block;
        }

        .interval-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .interval-title {
            font-weight: 800;
            font-size: clamp(18px, 5vw, 24px);
            margin: 0 0 8px 0;
        }

        .machine-type {
            font-size: clamp(12px, 3.5vw, 14px);
            color: #6B7280;
            margin-top: 4px;
        }

        .interval-intensity {
            font-size: clamp(14px, 4vw, 18px);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .interval-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .metric-pill {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: clamp(13px, 3.5vw, 16px);
            font-weight: 600;
            color: #111827;
        }

        /* Metric type colors */
        .metric-time {
            background: #E0E7FF;
        }

        /* Light indigo */
        .metric-weight {
            background: #FEE2E2;
        }

        /* Light red */
        .metric-reps {
            background: #F3E8FF;
        }

        /* Light purple */
        .metric-rest {
            background: #D1FAE5;
        }

        /* Light green */
        .metric-distance {
            background: #D1FAE5;
        }

        /* Light green */
        .metric-pace {
            background: #FEF3C7;
        }

        /* Light yellow */
        .metric-power {
            background: #FEE2E2;
        }

        /* Light red */
        .metric-rate {
            background: #F3E8FF;
        }

        /* Light purple */

        /* Error state */
        .error {
            color: #DC2626;
            padding: 16px;
            text-align: center;
            font-weight: 600;
        }

        .notes-section {
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid #E5E7EB;
        }

        .notes-block {
            margin-bottom: 24px;
        }

        .notes-block:last-child {
            margin-bottom: 0;
        }

        .notes-title {
            font-size: clamp(16px, 5vw, 20px);
            font-weight: 800;
            color: #111827;
            margin: 0 0 16px 0;
        }

        .notes-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .note-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            font-size: clamp(14px, 4vw, 16px);
            color: #374151;
        }

        .note-item:last-child {
            margin-bottom: 0;
        }

        .note-bullet {
            width: 6px;
            height: 6px;
            background: currentColor;
            border-radius: 50%;
            margin: 8px 12px 0 0;
            flex-shrink: 0;
        }


        .go-button {
            width: 100%;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
        }

        .go-button:hover {
            background-color: #3d8b40;
        }

        .go-button:active {
            transform: scale(0.98);
        }

        .timer-interval {
            text-align: center;
            padding: 32px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            margin: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .timer-activity {
            font-size: min(12vw, 48px);
            font-weight: 800;
            margin: 0 0 16px 0;
            color: #1a1a1a;
            line-height: 1.1;
        }

        .timer-intensity {
            font-size: min(6vw, 24px);
            color: #4338CA;
            margin-bottom: 24px;
            font-weight: 600;
        }

        .timer-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            margin: 24px 0;
        }

        .timer-metric {
            font-size: min(5vw, 20px);
            font-weight: 600;
            padding: 16px 24px;
            border-radius: 16px;
            color: #111827;
        }

        /* Specific metric types */
        .timer-metric-time {
            background: #E0E7FF;
            display: none;
            /* Hide the time for now since it is displayed elsewhere and messes up layout */
            /* /border-left: 4px solid #4338CA; */
        }

        .timer-metric-pace {
            background: #FEF3C7;
            /* border-left: 4px solid #D97706; */
        }

        .timer-metric-distance {
            background: #D1FAE5;
            /* border-left: 4px solid #059669; */
        }

        .timer-metric-power {
            background: #FEE2E2;
            /* border-left: 4px solid #DC2626; */
        }

        .timer-metric-rate {
            background: #F3E8FF;
            /* border-left: 4px solid #7C3AED; */
        }

        .timer-metric-reps,
        .timer-metric-sets {
            background: #F3E8FF;
            /* border-left: 4px solid #7C3AED; */
        }

        .timer-metric-weight {
            background: #FEE2E2;
            /* border-left: 4px solid #DC2626; */
        }

        .timer-description {
            font-size: min(4vw, 18px);
            color: #4B5563;
            margin-top: 16px;
            line-height: 1.4;
        }


        .rating-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rating-modal .rating-bold-gradient {
            width: 90%;
            max-width: 500px;
            margin: 20px;
            border-radius: 24px;
            padding: 32px 24px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
        }

        .rating-modal h2 {
            color: white;
            font-size: 32px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 32px;
        }

        .rating-modal .gradient-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .rating-modal .gradient-option {
            background: rgba(255, 255, 255, 0.98);
            padding: 24px;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .rating-modal .gradient-option:hover {
            transform: scale(1.02);
            background: white;
        }

        .rating-modal .gradient-option:active {
            transform: scale(0.98);
        }

        .rating-modal .emoji {
            font-size: 48px;
        }

        .rating-modal .rating-label {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }


        .complete-button {
            width: 100%;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            background-color: #4338CA;
            color: white;
            border: none;
            border-radius: 12px;
            margin-top: 20px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
        }

        .complete-button:hover {
            background-color: #3730a3;
        }

        .complete-button:active {
            transform: scale(0.98);
        }


        .dashboard-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .dashboard-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        /* Ensure the export bar doesn't overlap with content */
        #dashboard {
            padding-bottom: 80px;
            background: white;
            height: 100%;
        }

        .month-group {
            margin-bottom: 2rem;
        }

        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .month-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
        }

        .workout-count {
            font-size: 1.125rem;
            font-weight: 600;
            color: #4b5563;
        }

        .workout-card {
            position: relative;
            padding: 1rem;
            border-radius: 0.5rem;
            color: white;
            margin-bottom: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .workout-card.type-run {
            background-color: #2563eb;
        }

        .workout-card.type-strength {
            background-color: #7c3aed;
        }

        .workout-card.type-bike {
            background-color: #16a34a;
        }

        .workout-card.type-swim {
            background-color: #0891b2;
        }

        .level-circle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 4rem;
            height: 4rem;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .level-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #111827;
            line-height: 1;
        }

        .level-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
        }

        .workout-content {
            padding-right: 5rem;
        }

        .workout-date {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .workout-description {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .workout-duration {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .export-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .export-button {
            background: #111827;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .export-button:hover {
            background: #374151;
        }


        /* Update these styles to fix the vertical alignment */
        .level-widget {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin: 20px auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            touch-action: manipulation;
            position: relative;
            overflow: visible;
            /* Allow elements to overflow for proper positioning */
        }

        .fun-widget .content {
            display: flex;
            align-items: center;
            /* Keep elements centered vertically */
            gap: 16px;
            position: relative;
            z-index: 2;
            min-height: 72px;
            /* Match height of level circle */
            padding: 0%;
            /* Remove any padding that might affect alignment */
        }

        .fun-widget .level-circle {
            position: relative;
            z-index: 2;
            min-width: 72px;
            width: 72px;
            height: 72px;
            margin: 0;
            /* Remove any margin that might affect positioning */
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 800;
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            transition: transform 0.2s ease;
            flex-shrink: 0;
        }

        .fun-widget .progress-container {
            flex: 1;
            min-width: 0;
            margin-right: 48px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* Center content vertically */
        }

        .level-slider-panel {
            position: relative;
            z-index: 1;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed rgba(0, 0, 0, 0.1);
            width: 100%;
            /* Ensure full width */
        }

        .slider-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 0;
            /* Remove any padding that might affect positioning */
        }


        .fun-widget .more-btn {
            position: absolute;
            right: 8px;
            /* Adjust position */
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            color: #95A5A6;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
            z-index: 3;
            /* Ensure it's above other elements */
        }

        .fun-widget .level-circle {
            position: relative;
            z-index: 2;
            min-width: 72px;
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 800;
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            transition: transform 0.2s ease;
            flex-shrink: 0;
        }

        /* Ensure slider panel appears below the main content */
        .level-slider-panel {
            position: relative;
            z-index: 1;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed rgba(0, 0, 0, 0.1);
        }


        .fun-widget .level-circle:active {
            transform: scale(0.95);
        }

        .fun-widget .progress-container {
            flex: 1;
            min-width: 0;
        }

        .fun-widget .progress-dots {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .fun-widget .dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #E5E7EB;
            position: relative;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .fun-widget .dot.filled {
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            transform: scale(1.2);
        }

        .fun-widget .progress-text {
            font-size: 18px;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 8px;
        }

        .fun-widget .more-btn {
            width: 48px;
            height: 48px;
            background: none;
            border: none;
            color: #95A5A6;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .fun-widget .more-btn:active {
            background: rgba(0, 0, 0, 0.1);
        }

        .fun-widget.can-level-up .level-circle {
            background: linear-gradient(135deg, #4ECDC4, #45B7AF);
            animation: pulse 2s infinite;
        }


        .slider-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .level-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            color: white;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .level-btn:active {
            transform: scale(0.95);
        }

        input[type="range"] {
            flex: 1;
            height: 12px;
            -webkit-appearance: none;
            background: #E5E7EB;
            border-radius: 6px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .celebration-emoji {
            position: absolute;
            font-size: 40px;
            pointer-events: none;
            animation: celebrate 0.8s ease-out forwards;
        }

        @keyframes celebrate {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }

            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
            }

            100% {
                transform: scale(1) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('cardio')">Cardio</button>
            <button class="tab" onclick="switchTab('strength')">Strength</button>
            <button class="tab" onclick="switchTab('flexibility')">Flexibility</button>
            <button class="tab" onclick="switchTab('dashboard')">Dashboard</button>

        </div>

        <div id="cardio" class="content active">
            <div class="cardio-nav">
                <button class="active" onclick="switchCardio('run')">Running</button>
                <button onclick="switchCardio('bike')">Biking</button>
                <button onclick="switchCardio('swim')">Swimming</button>
                <button onclick="switchCardio('row')">Rowing</button>
            </div>
            <div id="level-selector">
                <!-- <div class="level-control"> -->
                <!-- <button class="level-btn" onclick="adjustLevel('cardio', -1)">-</button>
                    <input type="range" min="1" max="100" value="1" id="cardioLevel">
                    <button class="level-btn" onclick="adjustLevel('cardio', 1)">+</button>
                </div>
                <span class="level-display" id="cardioLevelDisplay">1</span> -->
            </div>
            <div id="cardioContent"></div>
        </div>

        <div id="strength" class="content">
            <div id="strengthContent"></div>
        </div>

        <div id="flexibility" class="content">
            <div id="flexContent"></div>
        </div>
        <div id="dashboard" class="content">
            <div id="workout-history"></div>
        </div>
    </div>

    <div class="timer-view" style="display: none;">
        <div class="timer-container">
            <div class="time-display">00:00</div>
            <div class="interval-info">
                <div class="current-activity">Get Ready!</div>
                <div class="next-up">Starting soon...</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="workout-progress">
                Set 1 of 3
            </div>
            <div class="controls">
                <button class="play-pause">Start</button>
                <button class="skip">Skip</button>
                <button class="reset">Reset</button>
                <button class="exit">Exit</button>
            </div>
        </div>
    </div>
    <script data-goatcounter="https://dfeldman.goatcounter.com/count" async src="/js/count.js"></script>
    <script src="strengthTraining.js"></script>
    <script src="cardioRunning.js"></script>
    <script src="cardioBiking.js"></script>
    <script src="cardioRowing.js"></script>
    <script src="cardioSwimming.js"></script>
    <script src="flexTraining.js"></script>
    <script src="intervalTimer.js"></script>
    <script src="workoutDisplay.js"></script>
    <script src="workoutRating.js"></script>
    <script src="userData.js"></script>
    <script src="userDashboard.js"></script>
    <script src="levelWidget.js"></script>
    <script>

        const userData = new UserData();
        let currentCardioType = 'run';
        let currentWorkout = {};

        // // Initialize ranges for all activities
        // document.getElementById('strengthLevel').value = userData.getLevel('strength') || 1;
        // document.getElementById('strengthLevelDisplay').textContent = userData.getLevel('strength') || 1;
        // document.getElementById('flexLevel').value = userData.getLevel('flexibility') || 1;
        // document.getElementById('flexLevelDisplay').textContent = userData.getLevel('flexibility') || 1;

        // Handle cardio level display based on current type
        function updateCardioLevelDisplay() {
            const currentLevel = userData.getLevel(currentCardioType) + 1;
            // document.getElementById('cardioLevel').value = currentLevel;
            // document.getElementById('cardioLevelDisplay').textContent = currentLevel;
        }

        // Initial cardio display
        updateCardioLevelDisplay();

        function adjustLevel(type, change) {
            // For cardio activities, use the current cardio type
            const activity = type === 'cardio' ? currentCardioType :
                type === 'flex' ? 'flexibility' : type;

            const currentLevel = userData.getLevel(activity) || 1;
            const newLevel = Math.max(1, Math.min(100, currentLevel + change));

            // Update the data store
            userData.setLevel(activity, newLevel);

            // Update the UI
            if (type === 'cardio') {
                document.getElementById('cardioLevel').value = newLevel;
                document.getElementById('cardioLevelDisplay').textContent = newLevel;
            } else {
                document.getElementById(`${type}Level`).value = newLevel;
                document.getElementById(`${type}LevelDisplay`).textContent = newLevel;
            }

            updateContent();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            } else {
                updateContent();
            }
        }

        function switchCardio(type) {
            currentCardioType = type;
            document.querySelectorAll('.cardio-nav button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateCardioLevelDisplay();
            updateCardioContent();
        }

        // Remove all references to the "levels" object and rely only on userData
        // document.getElementById('cardioLevel').addEventListener('input', (e) => {
        //     const newLevel = parseInt(e.target.value);
        //     userData.setLevel(currentCardioType, newLevel);
        //     document.getElementById('cardioLevelDisplay').textContent = newLevel;
        //     updateCardioContent();
        // });

        // document.getElementById('strengthLevel').addEventListener('input', (e) => {
        //     const newLevel = parseInt(e.target.value);
        //     userData.setLevel('strength', newLevel);
        //     document.getElementById('strengthLevelDisplay').textContent = newLevel;
        //     updateStrengthContent();
        // });

        // document.getElementById('flexLevel').addEventListener('input', (e) => {
        //     const newLevel = parseInt(e.target.value);
        //     userData.setLevel('flexibility', newLevel);
        //     document.getElementById('flexLevelDisplay').textContent = newLevel;
        //     updateFlexContent();
        // });


        function roundTo10Seconds(seconds) {
            return Math.round(seconds / 10) * 10;
        }


        // Helper functions for formatting and calculations
        //NOT USED
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.round(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function formatPace(minutesPerMile, unit = 'imperial') {
            console.log('Raw pace value received:', minutesPerMile);

            if (typeof minutesPerMile !== 'number') {
                console.error('Invalid pace value:', minutesPerMile);
                return '--:--/mi';
            }

            // Log the intermediate calculations
            const totalMinutes = unit === 'metric' ?
                minutesPerMile / 1.60934 :
                minutesPerMile;
            console.log('Total minutes:', totalMinutes);

            const minutes = Math.floor(totalMinutes);
            console.log('Minutes part:', minutes);

            const seconds = Math.round((totalMinutes - minutes) * 60);
            console.log('Seconds part:', seconds);

            const unit_label = unit === 'metric' ? '/km' : '/mi';

            // If it's a round minute
            if (seconds === 0) {
                const result = `${minutes} min${unit_label}`;
                console.log('Final result (round minutes):', result);
                return result;
            }

            // Otherwise show MM:SS format
            const result = `${minutes}:${seconds.toString().padStart(2, '0')}${unit_label}`;
            console.log('Final result (with seconds):', result);
            return result;
        }

        // HTML Formatting helper functions
        // TODO These are not currently used, but should probably be brought back
        function formatWorkoutHeader(workout) {
            return `
        <div class="workout-header">
            <h4>${workout.title}</h4>
            <div class="metrics-grid">
                ${workout.time ? `
                <div class="metric">
                    <span class="metric-label">Time</span>
                    <span class="metric-value">${workout.time} minutes</span>
                </div>
                ` : ''}
                ${workout.distance ? `
                    <div class="metric">
                        <span class="metric-label">Distance</span>
                        <span class="metric-value">${workout.type === 'swim' ?
                        `${workout.laps} laps (${workout.distance}yd)` :
                        workout.type === 'row' ?
                            `${workout.distance}m` :
                            `${workout.distance} miles`}</span>
                    </div>
                ` : ''}
                ${workout.pace ? `
                    <div class="metric">
                        <span class="metric-label">Target Pace</span>
                        <span class="metric-value">${formatPace(workout.pace, workout.type)}</span>
                    </div>
                ` : ''}
                ${workout.watts ? `
                    <div class="metric">
                        <span class="metric-label">Target Power</span>
                        <span class="metric-value">${workout.watts} watts</span>
                    </div>
                ` : ''}
                ${workout.spm ? `
                    <div class="metric">
                        <span class="metric-label">Stroke Rate</span>
                        <span class="metric-value">${workout.spm} SPM</span>
                    </div>
                ` : ''}
            </div>
        </div>`;
        }

        function formatWorkoutStructure(steps) {
            if (!steps || steps.length === 0) return '';
            return `
        <div class="workout-structure">
            <h5>Workout Structure</h5>
            <ol>
                ${steps.map(step => `<li>${step}</li>`).join('')}
            </ol>
        </div>`;
        }

        function formatFormCues(cues) {
            if (!cues || cues.length === 0) return '';
            return `
        <div class="form-cues">
            <h5>Form Cues</h5>
            <ul>
                ${cues.map(cue => `<li>${cue}</li>`).join('')}
            </ul>
        </div>`;
        }

        function formatNotes(notes) {
            if (!notes || notes.length === 0) return '';
            return `
        <div class="workout-notes">
            <h5>Important Notes</h5>
            <ul>
                ${notes.map(note => `<li>${note}</li>`).join('')}
            </ul>
        </div>`;
        }

        function formatCalories(calories) {
            return `
        <div class="calorie-estimate">
            <span class="label">Estimated Calories:</span>
            <span class="value">${calories}</span>
        </div>`;
        }
        // old don't use
        function formatIntervalSet(intervals) {
            if (!intervals) return '';
            return `
        <div class="interval-set">
            <h5>Interval Structure</h5>
            <div class="interval-details">
                <p>${intervals.sets} sets of:</p>
                <ul>
                    <li>Work: ${formatTime(intervals.activeTime)} at ${intervals.type.active}</li>
                    <li>Rest: ${formatTime(intervals.restTime)} at ${intervals.type.rest}</li>
                </ul>
            </div>
        </div>`;
        }



        // todo this is miles only, needs km
        function calculateDistance(durationSeconds, paceMinutesPerMile) {
            const hours = durationSeconds / 3600;
            const milesPerHour = 60 / paceMinutesPerMile;
            return +(hours * milesPerHour).toFixed(2);
        }

        // Modify the interval creation to include distance
        function addDistanceToInterval(interval) {
            if (interval.duration && interval.targetPace) {
                interval.distance = calculateDistance(interval.duration, interval.targetPace);
                interval.pace = interval.targetPace; // Make sure pace is accessible to the display
            }
            return interval;
        }

        // Main workout generation function
        function generateCardioWorkout(level, type) {
            function getPhase(level) {
                if (level <= 10) return 'basic';
                if (level <= 20) return 'intervals';
                if (level <= 30) return 'build';
                if (level <= 70) return 'endurance';
                return 'long';
            }

            const workout = {
                type,
                phase: getPhase(level)
            };

            // Workout type specific generation
            switch (type) {
                case 'run':
                    return generateRunWorkout(level, workout);
                case 'bike':
                    return generateBikeWorkout(level, workout);
                case 'swim':
                    return generateSwimWorkout(level, workout);
                case 'row':
                    return generateRowWorkout(level, workout);
                default:
                    throw new Error('Unsupported workout type');
            }
        }

        function updateStrengthContent() {
    const level = userData.getLevel('strength')+1;
    const workout = generateStrengthWorkout(level);
    currentWorkout = workout;
    const content = document.getElementById('strengthContent');
    content.innerHTML = ''; // Clear existing content

    // Create and add widget container
    const widgetContainer = document.createElement('div');
    widgetContainer.className = 'level-widget-container';
    content.appendChild(widgetContainer);

    // Create and add workout container
    const workoutContainer = document.createElement('div');
    workoutContainer.className = 'workout-container';
    content.appendChild(workoutContainer);

    // Create new level widget
    new LevelWidget(widgetContainer, 'strength');

    // Create workout display in the workout container
    const workoutDisplay = new WorkoutDisplay(
        workoutContainer,
        workout,
        { unitSystem: 'imperial' }
    );

    workoutDisplay.render();
}

function updateFlexContent() {
    const level = userData.getLevel('flexibility')+1;
    const workout = generateFlexWorkout(level);
    currentWorkout = workout;
    const content = document.getElementById('flexContent');
    content.innerHTML = ''; // Clear existing content

    // Create and add widget container
    const widgetContainer = document.createElement('div');
    widgetContainer.className = 'level-widget-container';
    content.appendChild(widgetContainer);

    // Create and add workout container
    const workoutContainer = document.createElement('div');
    workoutContainer.className = 'workout-container';
    content.appendChild(workoutContainer);

    // Create new level widget
    new LevelWidget(widgetContainer, 'flexibility');

    // Create workout display in the workout container
    const workoutDisplay = new WorkoutDisplay(
        workoutContainer,
        workout,
        { unitSystem: 'imperial' }
    );

    workoutDisplay.render();
}

        function updateCardioContent() {
            const level = userData.getLevel(currentCardioType)+1;
            const workout = generateCardioWorkout(level, currentCardioType);
            currentWorkout = workout;
            const content = document.getElementById('cardioContent');

            // Create or update level widget container
            let widgetContainer = document.getElementById('level-selector');
            if (!widgetContainer) {
                widgetContainer = document.createElement('div');
                widgetContainer.className = 'level-widget-container';
                content.insertBefore(widgetContainer, content.firstChild);
            } else {
                widgetContainer.className = 'level-widget-container';
            }

            // Create new level widget
            new LevelWidget(widgetContainer, currentCardioType);

            const workoutDisplay = new WorkoutDisplay(
                content,
                workout,
                { unitSystem: 'imperial' }
            );

            workoutDisplay.render();
        }

        // function updateFlexContent() {
        //     const level = userData.getLevel('flexibility');
        //     const workout = generateFlexWorkout(level);
        //     const content = document.getElementById('flexContent');
        //     currentWorkout = workout;

        //     const workoutDisplay = new WorkoutDisplay(
        //         content,
        //         workout,
        //         { unitSystem: 'imperial' }
        //     );


        //     levelWidgetContainer = document.getElementById('level-selector')
        //     const levelWidget = new LevelWidget(levelWidgetContainer, 'flexibility'); 
        //     workoutDisplay.render();
        // }


        function updateContent() {
            const activeTab = document.querySelector('.tab.active');
            if (!activeTab) {
                console.error('No active tab found');
                return;
            }

            const tabName = activeTab.getAttribute('onclick').match(/switchTab\('(.+)'\)/)[1];
            console.log('Updating content for active tab:', tabName);
            switch (tabName) {
                case 'cardio':
                    updateCardioContent();
                    break;
                case 'strength':
                    updateStrengthContent();
                    break;
                case 'flexibility':
                    updateFlexContent();
                    break;
                case 'dashboard':
                    // Don't try to update currentWorkout for dashboard
                    return;
                default:
                    console.error('Unknown tab type:', tabName);
            }
        }

        function updateDashboard() {
            const workouts = userData.getWorkoutHistory();
            const workoutHistoryViewer = new WorkoutHistoryViewer('workout-history', workouts);
        }



        // Initial content update
        updateContent();
    </script>
</body>

</html>